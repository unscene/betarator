#!/usr/bin/env node

var flatiron = require('flatiron'),
    path = require('path'),
    app = flatiron.app,
    connect = require('connect'),
    union = require('union'),
    betarator = require('./lib/index');

app.use(betarator.plugins.handlebars, {
    templatesDir: 'lib/views',
    partialsDir: 'lib/views/partials'
});

app.use(betarator.plugins.solr);
app.use(betarator.plugins.db);

app.use(betarator.plugins.injection,{
    on: betarator.routes.main,
    inject: {
		render: app.render
    }
})

app.use(flatiron.plugins.http, {
  before: [
      connect.static(path.resolve('.') + '/public'),
      connect.bodyParser(),
      connect.methodOverride(),
      connect.cookieParser("a"),
      connect.session({secret: "test"})
  ]
});

app.router.get("/", betarator.routes.main.index);

if (require.main === module) {
  app.init(function () {
    app.start(8080, function() {
    	app.log.info('web-application started on port 8080');
    });
  });
}
